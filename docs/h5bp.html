<!DOCTYPE html>  <html> <head>   <title>h5bp.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="h5bp-cli.html">                 h5bp-cli.js               </a>                                           <a class="source" href="h5bp.html">                 h5bp.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               h5bp.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>h5bp documentation generator</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>A static site generator writen in node. It's lyke Jehyll but somewhat simpler and more focused.
takes a <code>src</code> folder, runs it through Markdown and generate for each markdown file (.md, .mkd, .markdown)
a complete, static website.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Configuration</h2>

<p>The following is a list of the currently supported configuration options. These can all be specified by creating 
a config.yml (now a bacic commonjs module) file in the site’s root directory. There are also flags for the h5bp executable
which are described below next to their respective configuration options. The order of precedence for 
conflicting settings is: </p>

<ul>
<li>Command-line flags</li>
<li>Configuration file settings (config.yml)</li>
<li>Defaults (conf/config.js)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><em>usage: h5bp-docs [FILE, ...] [options]</em></p>

<pre><code> options:
   --verbose         Enable verbose output
   --server          Start a static connect server once generation done
   --src             Source folder where markdown files to process are stored
   --dest            Destination folder, place where the generated files will land
   --layout          layout file used to generate each files, using {{ content }} placeholder
   -h, --help        You're staring at it
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">),</span>
<span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">),</span>
<span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">),</span>
<span class="nx">findit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;findit&#39;</span><span class="p">),</span>
<span class="nx">ghm</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;github-flavored-markdown&#39;</span><span class="p">),</span>
<span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">),</span>
<span class="nx">Mustache</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mustache&#39;</span><span class="p">),</span>
<span class="nx">prettify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../support/prettify&#39;</span><span class="p">),</span>
<span class="nx">exec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">,</span>

<span class="nx">basePath</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>docco way of ensuring dir is there</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">ensureDir</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">ensureDir</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdir</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="mi">0777</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>little helper to recursively copy a directory from src to dir</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">copyDir</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">copyDir</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;rm -r &#39;</span> <span class="o">+</span> <span class="nx">to</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;cp -r &#39;</span> <span class="o">+</span> <span class="nx">src</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>    
  <span class="p">});</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>escapes internal wiki anchors</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">wikiAnchors</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">wikiAnchors</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\[\[([^|\]]+)\|([^\]]+)\]\]/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wholeMatch</span><span class="p">,</span> <span class="nx">m1</span><span class="p">,</span> <span class="nx">m2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">m1</span><span class="o">+</span><span class="s2">&quot;](&quot;</span> <span class="o">+</span> <span class="nx">m2</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\[\[([^\]]+)\]\]/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wholeMatch</span><span class="p">,</span> <span class="nx">m1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">m1</span><span class="o">+</span><span class="s2">&quot;](&quot;</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>escapes special ``` codeblock</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">escapeCodeBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/```(\w+)([^`]+)```/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wholeMatch</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="p">{</span>

    
    <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">wholeMatch</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>get rid of first and last line -> <code>language ànd</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">lines</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>add desired tab space</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">lines</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="nx">line</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
  <span class="p">});</span>
  
  <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>code highlighting helper. It uses prettify and run it against any <code>&lt;pre&gt;&lt;code&gt;</code> element</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">codeHighlight</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">codeHighlight</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;code&gt;[^&lt;]+&lt;\/code&gt;/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">code</span> <span class="o">=</span> <span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&lt;code&gt;([\s\S]+)&lt;\/code&gt;/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="nx">code</span> <span class="o">=</span> <span class="nx">prettify</span><span class="p">.</span><span class="nx">prettyPrintOne</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;code&gt;&quot;</span> <span class="o">+</span> <span class="nx">code</span> <span class="o">+</span> <span class="s2">&quot;&lt;/code&gt;&quot;</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>markdown parser to html and makes sure that code snippets are pretty enough</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">toHtml</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">toHtml</span><span class="p">(</span><span class="nx">markdown</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">codeHighlight</span><span class="p">(</span><span class="nx">ghm</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">wikiAnchors</span><span class="p">(</span><span class="nx">escapeCodeBlock</span><span class="p">(</span><span class="nx">markdown</span><span class="p">))));</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>start up a connect server with static middleware.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">server</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">server</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>but only for configuration with config.server set to true (--server)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">server</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="nx">connect</span><span class="p">.</span><span class="nx">createServer</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">baseurl</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">connect</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">dest</span><span class="p">)))</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">);</span>
    
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nServer started: localhost:&#39;</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">);</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>assets copy helper, fallbacks if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">copyAssets</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">copyAssets</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">assets</span> <span class="o">?</span> <span class="nx">config</span><span class="p">.</span><span class="nx">assets</span> <span class="o">:</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">),</span>
  <span class="nx">to</span> <span class="o">=</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">dest</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="nx">copyDir</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>utilty helper to determine which layout to use. It first tries to
get a layout template from where the excutable was used, it then fallbacks
to the default layout.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">computeLayout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">layout</span><span class="p">;</span>
  
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">layout</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">layout</span><span class="p">),</span> <span class="s1">&#39;utf8&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">layout</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">),</span> <span class="s1">&#39;utf8&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>    
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">layout</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>main process function.</h3>

<p>Scans the <code>src</code> whole directory, </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">[],</span>
  <span class="nx">fileReg</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;\\.&#39;</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">ext</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;$|\\.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">),</span>
  <span class="nx">layoutTmpl</span> <span class="o">=</span> <span class="nx">computeLayout</span><span class="p">(</span><span class="nx">config</span><span class="p">),</span>
  <span class="nx">destPath</span> <span class="o">=</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">dest</span><span class="p">),</span>
  <span class="nx">srcPath</span> <span class="o">=</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">src</span><span class="p">),</span>
  <span class="nx">print</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">print</span><span class="p">()</span><span class="err"> </span><span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">verbose</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>scans the whole dir</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ensureDir</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">process</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">findit</span><span class="p">(</span><span class="nx">srcPath</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">fileReg</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">file</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>prevent non markdown files</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>compute file's title: filename minus extension and -
compute href: filename/index.html</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">srcPath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">fileReg</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">title</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">),</span>
        <span class="nx">href</span> <span class="o">=</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span> <span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

        <span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">path</span><span class="o">:</span> <span class="nx">file</span><span class="p">,</span>
          <span class="nx">href</span><span class="o">:</span> <span class="nx">href</span><span class="p">,</span>
          <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">,</span>
          <span class="nx">title</span><span class="o">:</span> <span class="nx">title</span>
        <span class="p">});</span>
      <span class="p">})</span>

      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fileCount</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">layout</span><span class="p">;</span>
        <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;About to generate &#39;</span><span class="p">,</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">&#39; files \n\n&#39;</span><span class="p">);</span>
        <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;Writing Home Page to &#39;</span><span class="p">,</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">));</span>
        
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">),</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">layoutTmpl</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> 
          <span class="nx">files</span><span class="o">:</span> <span class="nx">files</span>
        <span class="p">}),</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>

        <span class="nx">files</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">toHtml</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)),</span>
          <span class="nx">dest</span> <span class="o">=</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">title</span> <span class="o">===</span> <span class="s1">&#39;Home&#39;</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">filename</span><span class="p">);</span>

          <span class="nx">output</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">layoutTmpl</span><span class="p">,</span> <span class="p">{</span><span class="nx">content</span><span class="o">:</span> <span class="nx">output</span><span class="p">,</span> <span class="nx">files</span><span class="o">:</span> <span class="nx">files</span><span class="p">});</span>

          <span class="nx">ensureDir</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;h5bp-docs: &#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="s1">&#39; -&gt; &#39;</span><span class="p">,</span> <span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">destPath</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">),</span> <span class="nx">output</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
            
            <span class="k">if</span><span class="p">((</span><span class="nx">fileCount</span><span class="o">--</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">copyAssets</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
              <span class="nx">server</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">});</span>

        <span class="p">});</span>
      <span class="p">});</span>    
  <span class="p">});</span>
  
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 